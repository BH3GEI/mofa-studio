# MoFA Studio - Pixi Configuration
# Replaces setup_isolated_env.sh and install_all_packages.sh
# Usage: pixi install && pixi run setup

[project]
name = "mofa-studio"
version = "0.1.0"
description = "MoFA Studio - Pure Rust UI Application (AI models downloaded on demand)"
channels = ["conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64", "win-64"]

# =============================================================================
# CONDA DEPENDENCIES (from conda-forge and pytorch channels)
# =============================================================================

[dependencies]
# Minimal dependencies for pure Rust version
# Python only needed for some optional webview apps
python = "3.12.*"

# System libraries (from conda-forge)
portaudio = "*"
openssl = "*"

# =============================================================================
# PYPI DEPENDENCIES
# =============================================================================

[pypi-dependencies]
# Minimal dependencies for pure version
# AI/ML models will be downloaded on demand or use cloud APIs
requests = "*"

# =============================================================================
# ENVIRONMENTS
# =============================================================================

[environments]
# Default environment (minimal, for pure Rust version)
default = { solve-group = "default" }

# =============================================================================
# TASKS
# =============================================================================

[tasks]
# Full setup task - run after `pixi install`
setup = { depends-on = ["build-rust"] }

# Build Rust project only (no Python nodes)
install-dora-cli = "cargo install dora-cli --locked"

# Build Rust nodes
build-rust = { depends-on = ["build-maas-client", "build-conference-bridge", "build-conference-controller"] }

build-maas-client = "cargo build --release --manifest-path node-hub/dora-maas-client/Cargo.toml"
build-conference-bridge = "cargo build --release --manifest-path node-hub/dora-conference-bridge/Cargo.toml"
build-conference-controller = "cargo build --release --manifest-path node-hub/dora-conference-controller/Cargo.toml"

# Test tasks
test-deps = "python models/setup-local-models/test_dependencies.py"
test-tts = "cd models/setup-local-models/kokoro-tts-validation && ./run_all_tests.sh"

# Development tasks
dev = "cargo run --release"
run = "cargo run --release"  # Alias for launching the app
dora-up = "dora up"
dora-stop = "dora destroy"

# Start voice chat dataflow
start-voice-chat = "dora up && dora start examples/mac-aec-chat/voice-chat-with-aec.yml"

# Clean tasks
clean-rust = "cargo clean"
clean = { depends-on = ["clean-rust"] }

# =============================================================================
# ACTIVATION SCRIPTS
# =============================================================================

[activation]
# Environment variables set when environment is activated
scripts = ["scripts/activate.sh"]

# Set environment variables
[activation.env]
MOFA_STUDIO_ROOT = "$PIXI_PROJECT_ROOT"
PYTHONPATH = "$PIXI_PROJECT_ROOT/libs/dora-common:$PYTHONPATH"
